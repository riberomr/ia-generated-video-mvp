generator client {
  provider = "prisma-client-js"
  output   = "../../../node_modules/.prisma/client"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum ScriptStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

model Course {
  id        String   @id @default(uuid())
  topic     String
  rawContent String  @db.Text
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  scripts   Script[]
}

model Script {
  id        String   @id @default(uuid())
  courseId  String
  course    Course   @relation(fields: [courseId], references: [id])
  scenes    Json
  status    ScriptStatus @default(DRAFT)
  originalScenes Json
  isTemplated Boolean @default(false)
  templateId String?
  templateData Json?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  videos    RenderedVideo[]
}

model RenderedVideo {
  id          String   @id @default(uuid())
  scriptId    String
  script      Script   @relation(fields: [scriptId], references: [id])
  status      String   // 'PENDING', 'PROCESSING', 'COMPLETED', 'FAILED'
  externalId  String?  // HeyGen ID
  downloadUrl String?
  provider    String   @default("HEYGEN") // 'HEYGEN' or 'SYNTHESIA'
  requestPayload Json?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model SynthesiaAvatar {
  id        String   @id // provider ID (e.g. "49dc8f46...")
  name      String
  gender    String
  version   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model SynthesiaVoice {
  id           String   @id // provider ID
  name         String   // e.g. "Natural", "Original"
  gender       String
  language     String   // e.g. "English (US)"
  languageCode String   // e.g. "en-US"
  nativeName   String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model SynthesiaVideoScript {
  id        String   @id @default(uuid())
  title     String
  scenes    Json     // Array of SceneConfig
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  sourceContentId String?
  sourceContent SourceContent? @relation(fields: [sourceContentId], references: [id])
  renderedVideos SynthesiaRenderedVideo[]
}

model SynthesiaRenderedVideo {
  id          String   @id @default(uuid())
  synthesiaId String
  status      String   // e.g., 'processing', 'completed', 'failed'
  downloadUrl String?
  createdAt   DateTime @default(now())
  scriptId    String?
  script      SynthesiaVideoScript? @relation(fields: [scriptId], references: [id])
}

model SourceContent {
  id        String   @id @default(uuid())
  title     String?
  content   String   @db.Text
  createdAt DateTime @default(now())
  scripts   SynthesiaVideoScript[]
}
